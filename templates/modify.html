<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- 인코딩 방식 및 뷰포트 설정 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 부트스트랩 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet" />

    <!-- 제이쿼리 CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- BULMA CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css" />

    <!-- 폰트 어썸 CDN -->
    <script defer src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"></script>

    <!-- 구글 폰트 CDN -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet" />

    <!-- CSS 연결 -->
    <link href="../static/css/signup.css" rel="stylesheet" />

    <title>정글 고리</title>

    <!-- JavaScript -->
    <script>
      $(document).ready(function () {
        // 업로드 버튼을 클릭하면 이미지 업로드
        $("#fileButton").click(function () {
          $("#image").click();
        });

        // 이미지 파일이 선택되었을 때 실행

        $("#image").change(function (e) {
          const file = e.target.files[0];

          if (file) {
            const reader = new FileReader();

            reader.onload = function (e) {
              // 이미지를 생성하고 표시
              $("#image_container img").attr("src", e.target.result);
            };

            reader.readAsDataURL(file);
          }
        });
        // ID 중복 체크 확인
        $("#userId").blur(function () {
          var userId = $("#userId").val();
          /* 콘솔에서 동작되는 지 확인 완료
          console.log(userId); blur */

          function checkUserId() {
            $.ajax({
              type: "GET",
              url: "/checkId",
              data: { id_give: userId },
              success: function (response) {
                if (response.result == "failure") {
                  alert("아이디가 중복됩니다.");
                } else {
                  return "success";
                }
              },
            });
          }
          checkUserId();
        });
      });

      function changeData(user_id) {
        $.ajax({
          type: "POST",
          url: "/mod/data",
          data: { user_id: user_id },
          success: function (response) {
            if (response["result"] == "success") {
              alert("수정 완료");
              window.location.href = "/main"; // 메인 페이지로 이동
            } else {
              alert("수정 실패");
            }
          },
        });
      }
    </script>
  </head>
  <body>
    <form id="signupForm" class="wrapper" onsubmit="return false">
      <div class="title"><h1>회원정보를 입력해 주세요</h1></div>
      <!-- bulma로 묶어주기 -->
      <div class="media">
        <div class="media-left">
          <div id="image_container" class="image is-128x128">
            <img src="{{ user_data.img }}" alt="기본 이미지" />
          </div>
          <button class="btn btn-primary" id="fileButton">업로드</button>
          <input type="file" id="image" name="img_give" accept="image/*" style="display: none" />
        </div>
        <div class="media-content">
          <!-- 아이디 -->
          <div class="id">
            <i class="fa-solid fa-address-card fa-2x"></i>
            <input name="id_give" id="userId" type="text" value="{{ user_data.user_id }}" disabled />
            <div class="check_font" id="id_check"></div>
          </div>
          <!-- 비밀번호 및 비밀번호 확인 -->
          <div class="password">
            <i class="fa-solid fa-lock fa-2x"></i>
            <input name="pw_give" id="password" type="password" value="{{ user_data.user_pw }}" />
          </div>
          <div class="password">
            <i class="fa-solid fa-lock fa-2x"></i>
            <input id="password2" type="password" value="{{ user_data.user_pw }}" />
          </div>
          <!-- 이름 -->
          <div class="name">
            <i class="fa-solid fa-user fa-2x"></i>
            <input name="name_give" id="userName" type="text" value="{{ user_data.user_name }}" />
          </div>
        </div>
      </div>
      <div class="article">
        <!-- MBTI -->
        <div>
          <i class="fa-solid fa-thumbtack fa-2x"></i>
          <select class="full-width" name="mbti_give" id="mbti">
            <option value="" disabled>MBTI</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intp" {% if user_data.mbti == 'intp' %}selected{% endif %}>INTP</option>
            <option value="entj" {% if user_data.mbti == 'entj' %}selected{% endif %}>ENTJ</option>
            <option value="entp" {% if user_data.mbti == 'entp' %}selected{% endif %}>ENTP</option>
            <option value="infj" {% if user_data.mbti == 'infj' %}selected{% endif %}>INFJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>
            <option value="intj" {% if user_data.mbti == 'intj' %}selected{% endif %}>INTJ</option>

            <option value="infp">INFP</option>
            <option value="enfj">ENFJ</option>
            <option value="enfp">ENFP</option>
            <option value="istj">ISTJ</option>
            <option value="isfj">ISFJ</option>
            <option value="estj">ESTJ</option>
            <option value="esfj">ESFJ</option>
            <option value="istp">ISTP</option>
            <option value="isfp">ISFP</option>
            <option value="estp">ESTP</option>
            <option value="esfp">ESFP</option>
          </select>
        </div>
        <!-- 거주지 -->
        <div>
          <i class="fa-solid fa-house-user fa-2x"></i>
          <select class="full-width" name="region_give" id="region">
            <option value="" disabled selected>거주지</option>
            <option value="02">서울</option>
            <option value="031_0">경기 북부</option>
            <option value="031_1">경기 남부</option>
            <option value="051">부산</option>
            <option value="053">대구</option>
            <option value="032">인천</option>
            <option value="062">광주</option>
            <option value="042">대전</option>
            <option value="052">울산</option>
            <option value="044">세종</option>
            <option value="031">강원</option>
            <option value="043">충북</option>
            <option value="041">충남</option>
            <option value="063">전북</option>
            <option value="061">전남</option>
            <option value="054">경북</option>
            <option value="055">경남</option>
            <option value="064">제주</option>
          </select>
        </div>
        <!-- 흡연 여부 -->
        <div>
          <i class="fa-solid fa-smoking fa-2x"></i>
          <select class="full-width" name="smoking_give" id="smoke">
            <option value="" disabled selected>흡연</option>
            <option value="yes">예</option>
            <option value="no">아니오</option>
          </select>
        </div>
        <!-- 성별 -->
        <div>
          <i class="fa-solid fa-venus-double fa-2x"></i>
          <select class="full-width" name="gender_give" id="gender">
            <option value="" disabled selected>성별</option>
            <option value="man">남자</option>
            <option value="women">여자</option>
          </select>
        </div>
        <!-- 학교 -->
        <div>
          <i class="fa-solid fa-address-card fa-2x"></i>
          <input class="full-width" name="university_give" id="university" type="text" value="{{ user_data.univ }}" />
        </div>
        <!-- 학과 -->
        <div>
          <i class="fa-solid fa-graduation-cap fa-2x"></i>
          <input class="full-width" name="major_give" id="major" type="text" value="{{ user_data.major }}" />
        </div>
      </div>
      <div class="buttons">
        <button type="submit" class="btn btn-primary" onclick="changeData()">수정</button>
        <button class="btn btn-primary">취소</button>
      </div>
    </form>
  </body>
</html>
